<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyB4JIv0kny1PG_d2bsbGXxt0eQbxrzHWo4", 
        authDomain: "starzbet-score.firebaseapp.com", 
        projectId: "starzbet-score", 
        storageBucket: "starzbet-score.firebasestorage.app", 
        messagingSenderId: "100283892830", 
        appId: "1:100283892830:web:d970d37961616762ef60cf" 
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // GLOBAL KAYIT FONKSİYONU
    window.saveGlobal = async (s) => { 
        try { 
            await addDoc(collection(db, "scores"), { 
                name: (window.Telegram.WebApp.initDataUnsafe?.user?.first_name || "MERT").toUpperCase(), 
                points: s, 
                timestamp: serverTimestamp() 
            }); 
        } catch(e){ console.error(e); } 
    };

    // GLOBAL LİDERLERİ YÜKLEME FONKSİYONU
    window.loadLeaders = async () => {
        const container = document.getElementById('leader-list');
        if(!container) return;
        container.innerHTML = "<p style='text-align:center; color:#555;'>Yükleniyor...</p>";
        
        try {
            const q = query(collection(db, "scores"), orderBy("points", "desc"), limit(10));
            const snap = await getDocs(q);
            
            if(snap.empty) {
                container.innerHTML = "<p style='text-align:center; color:#555;'>Henüz skor yok!</p>";
                return;
            }

            container.innerHTML = "";
            let i = 1;
            snap.forEach(doc => {
                const d = doc.data();
                container.innerHTML += `
                    <div style="background:#111; padding:15px; border-radius:15px; margin-bottom:10px; display:flex; justify-content:space-between; border-left:4px solid var(--gold); border-right:1px solid #222; border-top:1px solid #222; border-bottom:1px solid #222;">
                        <span style="font-weight:bold;">#${i} ${d.name}</span>
                        <span style="color:var(--gold); font-family:'Orbitron'; font-size:14px;">${d.points}</span>
                    </div>`;
                i++;
            });
        } catch (e) { 
            container.innerHTML = "<p style='color:red;'>Veriler çekilemedi.</p>";
            console.error(e);
        }
    };
</script>

<script>
    // SAYFA DEĞİŞTİRME FONKSİYONU (FIXED)
    function tab(id, el) {
        // Tüm ekranları gizle
        document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        // Seçilen ekranı göster
        const target = document.getElementById(id);
        if(target) {
            target.style.display = 'block';
            if(el) el.classList.add('active');
        }

        // Eğer liderler sayfasıysa verileri çek
        if(id === 'ranks') {
            if(window.loadLeaders) window.loadLeaders();
        }
        
        window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }

    // Ana sayfayı varsayılan olarak aç
    window.onload = () => {
        tab('home', document.querySelector('.nav-btn.active'));
    };

    // ... (Diğer oyun kodları - Snake, Tower vb. - olduğu gibi kalsın) ...
</script>
