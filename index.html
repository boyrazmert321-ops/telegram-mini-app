<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Starzbet Gaming World</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #ffcc00; --accent: #00ffcc; --bg: #050505; --card: #121212; --text: #ffffff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; margin: 0; overflow: hidden; height: 100vh; }

        /* GÄ°RÄ°Å EKRANI (SPLASH) */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10000;
        }
        .loader { width: 80px; height: 80px; border: 4px solid #333; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; box-shadow: 0 0 15px var(--primary); }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ANA YAPI */
        #app { display: none; height: 100vh; flex-direction: column; }
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .balance { background: #1a1a1a; padding: 8px 15px; border-radius: 30px; border: 1px solid var(--primary); font-weight: bold; color: var(--primary); }

        /* EKRANLAR */
        .screen { flex-grow: 1; display: none; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .screen.active { display: block; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* OYUN KARTLARI */
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .game-card { background: var(--card); border-radius: 20px; padding: 25px 15px; text-align: center; border: 1px solid #222; transition: 0.3s; position: relative; overflow: hidden; }
        .game-card:active { transform: scale(0.95); border-color: var(--primary); }
        .game-card i { font-size: 45px; display: block; margin-bottom: 12px; }
        .game-card h3 { margin: 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }

        /* OYUN SAHNESÄ° */
        #game-stage { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: none; flex-direction: column; }
        canvas { background: #080808; display: block; margin: auto; border: 2px solid #222; }
        .game-nav { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #111; }

        /* ALT MENÃœ */
        .nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: #0a0a0a; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #222; padding-bottom: 10px; }
        .nav-item { background: none; border: none; color: #555; display: flex; flex-direction: column; align-items: center; font-size: 10px; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <div id="splash">
        <div class="loader"></div>
        <h2 style="color:var(--primary); margin-top:30px; text-align:center; padding: 0 20px;">STARZBET'Ä°N KÃœÃ‡ÃœK DÃœNYASINA HOÅGELDÄ°NÄ°Z</h2>
    </div>

    <div id="app">
        <div class="header">
            <div id="user-info" style="font-weight:bold;">OYUNCU</div>
            <div class="balance">ğŸ’° <span id="puan-toplam">0</span></div>
        </div>

        <div id="home" class="screen active">
            <div style="background: linear-gradient(90deg, #ffcc00, #ff9900); padding: 20px; border-radius: 20px; color: #000;">
                <h2 style="margin:0">GÃ¼nÃ¼n ÅanslÄ±sÄ± Sen misin?</h2>
                <p style="margin:5px 0">OyunlarÄ± oyna, sÄ±ralamada yÃ¼ksel!</p>
            </div>

            <div class="game-grid">
                <div class="game-card" onclick="play('tower')"><i>ğŸ—ï¸</i><h3>Kule Yap</h3></div>
                <div class="game-card" onclick="play('space')"><i>ğŸš€</i><h3>Uzaydan KaÃ§</h3></div>
                <div class="game-card" onclick="play('snake')"><i>ğŸ</i><h3>YÄ±lan Pro</h3></div>
                <div class="game-card" onclick="play('guess')"><i>ğŸ°</i><h3>SayÄ± Bul</h3></div>
            </div>
        </div>

        <div id="leader" class="screen"><h2 style="text-align:center">ğŸ† Liderler Tablosu</h2><p style="text-align:center; color:#666;">YakÄ±nda aktif edilecek...</p></div>

        <nav class="nav">
            <button class="nav-item active" onclick="show('home', this)"><span>ğŸ </span><br>KEÅFET</button>
            <button class="nav-item" onclick="show('leader', this)"><span>ğŸ†</span><br>LÄ°DERLER</button>
        </nav>
    </div>

    <div id="game-stage">
        <div class="game-nav">
            <button onclick="exitGame()" style="background:red; color:white; border:none; padding:5px 15px; border-radius:5px;">Ã‡IK</button>
            <div style="font-size:20px;">SKOR: <span id="current-score">0</span></div>
            <div></div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        let totalPuan = parseInt(localStorage.getItem('starzPuan')) || 0;
        document.getElementById('puan-toplam').innerText = totalPuan;

        if (tg.initDataUnsafe?.user) {
            document.getElementById('user-info').innerText = tg.initDataUnsafe.user.first_name.toUpperCase();
        }

        setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('app').style.display = 'flex';
        }, 3000);

        function show(id, btn) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let loop, score = 0, gameActive = false;

        function play(game) {
            document.getElementById('game-stage').style.display = 'flex';
            canvas.width = window.innerWidth - 40;
            canvas.height = window.innerHeight * 0.7;
            score = 0; document.getElementById('current-score').innerText = '0';
            gameActive = true;
            if(game === 'tower') runTower();
            if(game === 'space') runSpace();
            if(game === 'snake') runSnake();
            if(game === 'guess') runGuess();
        }

        // --- GAME MOTORS ---
        function runTower() {
            let blocks = [{x: canvas.width/2-50, y: canvas.height-30, w: 100}];
            let cur = {x: 0, y: canvas.height-60, w: 100, vx: 4};
            function draw() {
                if(!gameActive) return;
                ctx.clearRect(0,0,canvas.width,canvas.height);
                blocks.forEach(b => { ctx.fillStyle='#ffcc00'; ctx.fillRect(b.x, b.y, b.w, 28); });
                ctx.fillStyle='#fff'; ctx.fillRect(cur.x, cur.y, cur.w, 28);
                cur.x += cur.vx;
                if(cur.x + cur.w > canvas.width || cur.x < 0) cur.vx *= -1;
                loop = requestAnimationFrame(draw);
            }
            draw();
            canvas.onclick = () => {
                let last = blocks[blocks.length-1];
                if(cur.x > last.x + last.w || cur.x + cur.w < last.x) return finish();
                score++; document.getElementById('current-score').innerText = score;
                blocks.push({x: cur.x, y: cur.y, w: cur.w});
                cur.y -= 30; if(blocks.length > 10) blocks.forEach(b => b.y += 30), cur.y += 30;
                tg.HapticFeedback.impactOccurred('medium');
            };
        }

        function runSpace() {
            let p = {y: canvas.height/2}; let obs = [];
            function draw() {
                if(!gameActive) return;
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle='#00ffcc'; ctx.fillRect(40, p.y, 30, 30);
                if(Math.random() < 0.05) obs.push({x: canvas.width, y: Math.random()*canvas.height, w: 20, h: 40});
                obs.forEach((o, i) => {
                    o.x -= 6; ctx.fillStyle='red'; ctx.fillRect(o.x, o.y, o.w, o.h);
                    if(40 < o.x + o.w && 70 > o.x && p.y < o.y + o.h && p.y + 30 > o.y) finish();
                });
                score++; document.getElementById('current-score').innerText = Math.floor(score/10);
                loop = requestAnimationFrame(draw);
            }
            draw();
            canvas.onclick = () => { p.y -= 60; tg.HapticFeedback.impactOccurred('light'); };
            setInterval(() => { p.y += 3; }, 30);
        }

        function runSnake() {
            let s = [{x:10, y:10}], f = {x:15, y:15}, d = {x:1, y:0};
            let step = 0;
            function draw() {
                if(!gameActive) return;
                if(++step < 5) { loop = requestAnimationFrame(draw); return; }
                step = 0;
                ctx.clearRect(0,0,canvas.width,canvas.height);
                let head = {x: s[0].x + d.x, y: s[0].y + d.y};
                s.unshift(head);
                if(head.x === f.x && head.y === f.y) { score += 10; f = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*20)}; }
                else s.pop();
                if(head.x < 0 || head.y < 0 || head.x > 25 || head.y > 25) return finish();
                ctx.fillStyle='lime'; s.forEach(p => ctx.fillRect(p.x*15, p.y*15, 14, 14));
                ctx.fillStyle='red'; ctx.fillRect(f.x*15, f.y*15, 14, 14);
                document.getElementById('current-score').innerText = score;
                loop = requestAnimationFrame(draw);
            }
            draw();
            canvas.onclick = (e) => {
                let rect = canvas.getBoundingClientRect();
                let x = e.clientX - rect.left;
                if(x < canvas.width/2) { // Sola dÃ¶n
                    let temp = d.x; d.x = d.y; d.y = -temp;
                } else { // SaÄŸa dÃ¶n
                    let temp = d.x; d.x = -d.y; d.y = temp;
                }
            };
        }

        function runGuess() {
            let target = Math.floor(Math.random()*100);
            ctx.fillStyle='white'; ctx.font='20px Arial'; ctx.fillText('1-100 arasÄ± sayÄ± tuttum!', 20, 50);
            ctx.fillText('Tahmin etmek iÃ§in ekrana bas!', 20, 100);
            canvas.onclick = () => {
                let g = prompt("Tahminin?");
                if(g == target) { alert("BÄ°LDÄ°N!"); score += 100; finish(); }
                else if(g < target) alert("DAHA BÃœYÃœK");
                else alert("DAHA KÃœÃ‡ÃœK");
            };
        }

        function finish() {
            gameActive = false;
            cancelAnimationFrame(loop);
            tg.HapticFeedback.notificationOccurred('error');
            alert("OYUN BÄ°TTÄ°! SKOR: " + score);
            totalPuan += score;
            localStorage.setItem('starzPuan', totalPuan);
            document.getElementById('puan-toplam').innerText = totalPuan;
            exitGame();
        }

        function exitGame() {
            gameActive = false;
            cancelAnimationFrame(loop);
            document.getElementById('game-stage').style.display = 'none';
        }
    </script>
</body>
</html>
